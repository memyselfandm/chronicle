#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Chronicle Pre-commit Hook
# Runs tests and coverage checks before allowing commits

echo "ğŸ” Running pre-commit checks..."

# Run linting
echo "ğŸ“‹ Linting code..."
npm run lint || {
  echo "âŒ Linting failed. Please fix the issues and try again."
  exit 1
}

# Run tests with coverage (fast mode)
echo "ğŸ§ª Running tests with coverage..."
npm run test:coverage || {
  echo "âŒ Tests failed. Please fix failing tests and try again."
  exit 1
}

# Check coverage thresholds
echo "ğŸ“Š Checking coverage thresholds..."
npm run coverage:check || {
  echo "âŒ Coverage below thresholds. Please add tests and try again."
  echo "ğŸ’¡ Run 'npm run coverage:report' to see detailed coverage info."
  exit 1
}

echo "âœ… All pre-commit checks passed!"